<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.admin.member">
<resultMap id="memberResult" type="MemberVO">
    <result property="member_num" column="member_num"/>
    <result property="member_id" column="member_id"/>
    <result property="member_pw" column="member_pw"/>
    <result property="member_name" column="member_name"/>
    <result property="member_gender" column="member_gender"/>
    <result property="member_birth_y" column="member_birth_y"/>
    <result property="member_birth_m" column="member_birth_m"/>
    <result property="member_birth_d" column="member_birth_d"/>
    <result property="member_birth_gn" column="member_birth_gn"/>
    <result property="tel1" column="tel1"/>
    <result property="tel2" column="tel2"/>
    <result property="tel3" column="tel3"/>
    <result property="email1" column="email1"/>
    <result property="email2" column="email2"/>
    <result property="emailsts_yn" column="emailsts_yn"/>
    <result property="zipcode" column="zipcode"/>
    <result property="roadAddress" column="roadAddress"/>
    <result property="jibunAddress" column="jibunAddress"/>
    <result property="namujiAddress" column="namujiAddress"/>
    <result property="member_join" column="member_join"/>
    <result property="del_yn" column="del_yn"/>
    <result property="role" column="role"/>
</resultMap>


<!-- MySQL용 페이징 + 조건식, 문자열 결합 등 수정 -->
<select id="listMember" resultMap="memberResult" parameterType="java.util.HashMap">
    SELECT *
    FROM member
    WHERE DATE_FORMAT(joinDate, '%Y-%m-%d') BETWEEN #{beginDate} AND #{endDate}
    <if test="search_type == 'member_id'">
        AND member_id = #{search_word}
    </if>
    <if test="search_type == 'member_name'">
        AND member_name = #{search_word}
    </if>
    <if test="search_type == 'member_hp_num'">
        AND CONCAT(tel1, tel2, tel3) = #{search_word}
    </if>
    ORDER BY joinDate DESC
    LIMIT #{offset}, 10
</select>


<select id="memberDetail" resultMap="memberResult" parameterType="String">
    SELECT * FROM member
    WHERE member_id = #{member_id}
</select>

<update id="modifyMemberInfo" parameterType="java.util.HashMap">
    UPDATE member
    <set>
        <if test="member_pw != '' and member_pw != null">member_pw = #{member_pw},</if>
        <if test="member_gender != '' and member_gender != null">member_gender = #{member_gender},</if>
        <if test="member_birth_y != '' and member_birth_y != null">member_birth_y = #{member_birth_y},</if>
        <if test="member_birth_m != '' and member_birth_m != null">member_birth_m = #{member_birth_m},</if>
        <if test="member_birth_d != '' and member_birth_d != null">member_birth_d = #{member_birth_d},</if>
        <if test="tel1 != '' and tel1 != null">tel1 = #{tel1},</if>
        <if test="tel2 != '' and tel2 != null">tel2 = #{tel2},</if>
        <if test="tel3 != '' and tel3 != null">tel3 = #{tel3},</if>
        <if test="smssts_yn != '' and smssts_yn != null">smssts_yn = #{smssts_yn},</if>
        <if test="email1 != '' and email1 != null">email1 = #{email1},</if>
        <if test="email2 != '' and email2 != null">email2 = #{email2},</if>
        <if test="emailsts_yn != '' and emailsts_yn != null">emailsts_yn = #{emailsts_yn},</if>
        <if test="zipcode != '' and zipcode != null">zipcode = #{zipcode},</if>
        <if test="roadAddress != '' and roadAddress != null">roadAddress = #{roadAddress},</if>
        <if test="jibunAddress != '' and jibunAddress != null">jibunAddress = #{jibunAddress},</if>
        <if test="namujiAddress != '' and namujiAddress != null">namujiAddress = #{namujiAddress},</if>
        <if test="del_yn != '' and del_yn != null">del_yn = #{del_yn}</if>
    </set>
    WHERE member_id = #{member_id}
</update>
</mapper>