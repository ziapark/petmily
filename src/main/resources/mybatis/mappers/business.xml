<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="mapper.business">
		<resultMap id="businessResult" type="BusinessVO">
    		<result property="business_id" column="business_id"/>
		    <result property="seller_id" column="seller_id"/>
		    <result property="seller_pw" column="seller_pw"/>
		    <result property="business_name" column="business_name"/>
		    <result property="business_type" column="business_type"/>
		    <result property="owner_name" column="owner_name"/>
		    <result property="business_number" column="business_number"/>
		    <result property="phone1" column="phone1"/>
		    <result property="phone2" column="phone2"/>
		    <result property="phone3" column="phone3"/>
		    <result property="email1" column="email1"/>
		    <result property="email2" column="email2"/>
		    <result property="zipcode" column="zipcode"/>
		    <result property="roadAddress" column="roadAddress"/>
		    <result property="jibunAddress" column="jibunAddress"/>
		    <result property="namujiAddress" column="namujiAddress"/>
		    <result property="description" column="description"/>
		    <result property="bank_name" column="bank_name"/>
		    <result property="bank_account" column="bank_account"/>
		    <result property="bank_holder" column="bank_holder"/>
		    <result property="approval_status" column="approval_status"/>
		    <result property="role" column="role"/>
		    <result property="reg_date" column="reg_date"/>
		    <result property="del_yn" column="del_yn"/>
		</resultMap>
		<!-- 상품 ResultMap -->
		<resultMap id="goodsResult" type="GoodsVO">
			<result property="goods_num" column="goods_num" />
			<result property="goods_name" column="goods_name" />
			<result property="seller_id" column="seller_id" />
			<result property="goods_maker" column="goods_maker" />
			<result property="goods_category" column="goods_category" />
	
			<result property="goods_sales_price" column="goods_sales_price" />
			<result property="goods_point" column="goods_point" />
			<result property="goods_stock" column="goods_stock" />
			<result property="goods_delivery_price"
				column="goods_delivery_price" />
			<result property="goods_fileName" column="goods_fileName" />
			<result property="goods_status" column="goods_status" />
			<result property="goods_goods_writer_intro"
				column="goods_goods_writer_intro" />
			<result property="goods_contents_order"
				column="goods_contents_order" />
			<result property="goods_credate" column="goods_credate" />
		</resultMap>
	
		<!-- 이미지 ResultMap -->
		<resultMap id="imageResult" type="imageFileVO">
			<result property="image_id" column="image_id" />
			<result property="goods_num" column="goods_num" />
			<result property="fileName" column="fileName" />
			<result property="fileType" column="fileType" />
			<result property="reg_id" column="reg_id" />
			<result property="reg_day" column="reg_day" />
		</resultMap>
		<!-- 사업자 로그인 -->
		<select id="busilogin" resultType="BusinessVO"  parameterType="BusinessVO"  >
	    	<![CDATA[
				select * from business 
			 	where seller_id=#{seller_id}
			 	and seller_pw=#{seller_pw}
			]]>
		</select>	
		<!-- 사업자 회원가입 -->
		<insert id="insertNewBusinesspartner" parameterType="BusinessVO">
			<![CDATA[
				insert into business(		
				seller_id, seller_pw, business_name, business_type, owner_name, business_number, phone1, phone2, phone3, email1, email2, zipcode,
				roadAddress, jibunAddress, namujiAddress, description, bank_name, bank_account, bank_holder)
				values(
				#{seller_id}, #{seller_pw}, #{business_name}, #{business_type}, #{owner_name}, #{business_number}, #{phone1}, #{phone2}, #{phone3}, 
				#{email1}, #{email2}, #{zipcode}, #{roadAddress}, #{jibunAddress}, #{namujiAddress}, #{description}, #{bank_name}, #{bank_account}, #{bank_holder})
		 	]]>
		</insert>
		<!-- 아이디 중복검사 -->
		<select id="selectOverlappedID" parameterType="String" resultType="int">
		    <![CDATA[
		        select 
		            (select count(*) from member where member_id = #{member_id}) +
		            (select count(*) from business where seller_id = #{member_id})
		        as total_count
		    ]]>
		</select>
		
		<!-- 사업자번호 중복검사 -->
		<select id="isBusinessNumberDuplicate" parameterType="String" resultType="String">
		    <![CDATA[
		        select 
		          case when count(*) > 0 then 'true' else 'false' end as result
		        from business
		        where business_number = #{business_number}
		    ]]>
		</select>
		
		<select id="listMyGoods" parameterType="BusinessVO" resultType="BusinessVO">
			<![CDATA[
				select * from business
        		where business_number=#{business_number}
			]]>
		</select>
		<!-- 승인 정보 불러오기 -->
	<select id="mypension" parameterType="BusinessVO" resultType="BusinessVO">
	<![CDATA[
		select business_name, business_type, owner_name, zipcode, roadAddress, jibunAddress, namujiAddress, approval_status from
		business where business_number = #{business_number}
	]]>
	</select>
			<!-- 사업자 정보 불러오기 -->
	<select id="businessDetailInfo" parameterType="BusinessVO" resultType="BusinessVO">
	<![CDATA[
		select * from business where business_number = #{business_number}
	]]>
	</select>
		<!-- 사업자 정보 수정 -->
	<update id="updateMyInfo" parameterType="java.util.HashMap">
	 update business
			   <set>
			      <if test="seller_pw != '' and seller_pw != null">
			        seller_pw=#{seller_pw},
			      </if>
			      <if test="phone1 != '' and phone1 != null">
			         phone1=#{phone1},
			      </if>
			      <if test="phone2 != '' and phone2 != null">
			         phone2=#{phone2},
			      </if>
			      <if test="phone3 != '' and phone3 != null">
			         phone3=#{phone3},
			      </if>
			      <if test="email1 != '' and email1 != null">
			         email1=#{email1},
			      </if>
			      <if test="email2 != '' and email2 != null">
			         email2=#{email2},
			      </if>
			      <if test="zipcode != '' and zipcode != null">
			         zipcode=#{zipcode},
			      </if>
			      <if test="roadAddress != '' and roadAddress != null">
			         roadAddress=#{roadAddress},
			      </if>			     	
			      <if test="jibunAddress != '' and jibunAddress != null">
			         jibunAddress=#{jibunAddress},
			      </if>
			      <if test="namujiAddress != '' and namujiAddress != null">
			         namujiAddress=#{namujiAddress}
			      </if>
			      <if test="bank_name != '' and bank_name != null">
			         bank_name=#{bank_name}
			      </if>
			      <if test="bank_account != '' and bank_account != null">
			         bank_account=#{bank_account}
			      </if>
			      <if test="bank_holder != '' and bank_holder != null">
			         bank_holder=#{bank_holder}
			      </if>
			   </set>
		where business_number=#{business_number}
	</update>
	<update id="removebusiness" parameterType="String">
		update business set del_yn = 'Y' where business_number = #{business_number}
	</update>
		
	<resultMap id="pensionResult" type="pensionVO">
	<result property="p_num" column="p_num"/>
	<result property="business_id" column="business_id"/>
	<result property="p_name" column="p_name"/>
	<result property="tel1" column="tel1"/>
	<result property="tel2" column="tel2"/>
	<result property="tel3" column="tel3"/>
	<result property="checkin_time" column="checkin_time"/>
	<result property="checkout_time" column="checkout_time"/>
	<result property="room_count" column="room_count"/>
	<result property="max_capacity" column="max_capacity"/>
	<result property="facilities" column="facilities"/>
	<result property="description" column="description"/>
	<result property="reg_date" column="reg_date"/>
	<result property="del_yn" column="del_yn"/>
</resultMap>

	<!-- 펜션 등록 -->
	<insert id="insertpension" parameterType="pensionVO" useGeneratedKeys="true" keyProperty="p_num">
	<![CDATA[
		insert into pension(
		business_id, p_name, tel1, tel2, tel3, checkin_time, checkout_time, room_count, facilities, description)
		values(
		#{business_id}, #{p_name}, #{tel1}, #{tel2}, #{tel3}, #{checkin_time}, #{checkout_time}, #{room_count}, #{facilities}, #{description})
	]]>
</insert>
<!-- 펜션 정보 조회 -->
<select id="pension" resultType="pensionVO">
	<![CDATA[
		select * from pension where business_id = #{business_id}
	]]>
</select>	
<update id="updatepension" parameterType="pensionVO">
	<![CDATA[
	update pension 
	set 
		p_name = #{p_name}, 
		tel1 = #{tel1}, 
		tel2 = #{tel2}, 
		tel3 = #{tel3}, 
		checkin_time = #{checkin_time},
		checkout_time = #{checkout_time},
		room_count = #{room_count},
		facilities = #{facilities}, 
		description = #{description}
	where p_num = #{p_num}
	]]>
</update>
<update id="removepension" parameterType="int">
	<![CDATA[
	update pension set del_yn = 'Y' where p_num = #{p_num}
	]]>
</update>

<resultMap id="roomResult" type="roomVO">
	<result property="room_id" column="room_id"/>
	<result property="p_num" column="p_num"/>
	<result property="room_name" column="room_name"/>
	<result property="room_type" column="room_type"/>
	<result property="price" column="price"/>
	<result property="max_capacity" column="max_capacity"/>
	<result property="bed_type" column="bed_type"/>
	<result property="room_size" column="room_size"/>
	<result property="room_description" column="room_description"/>
	<result property="amenities" column="amenities"/>
	<result property="reg_date" column="reg_date"/>
	<result property="del_yn" column="del_yn"/>
	<result property="fileimage" column="fileimage"/>
</resultMap>
<!-- 펜션 세부 등록 -->
	<insert id="insertroom" parameterType="roomVO">
		<![CDATA[
		insert into room(
		room_id, p_num, room_name, room_type, price, max_capacity, bed_type, room_size, room_description, amenities, fileimage)
		values(
		#{room_id}, #{p_num}, #{room_name}, #{room_type}, #{price}, #{max_capacity}, #{bed_type}, #{room_size}, #{room_description}, #{amenities}, #{fileimage})
		]]>
	</insert>
	<!-- 펜션 세부정보 조회 -->
	<select id="selectroomList" parameterType="String" resultMap="roomResult">
		<![CDATA[
		select * from room where p_num = #{p_num}
		]]>
	</select>
	<!-- 사업자 정보 불러오기 -->
	<select id="roomDetailInfo" parameterType="roomVO" resultType="roomVO">
	<![CDATA[
		select * from room where room_id = #{room_id}
	]]>
	</select>
	<!-- 사업자 정보 수정 -->
	<update id="updateMyroom" parameterType="java.util.HashMap">
	 update room
			   <set>
			      <if test="room_name != '' and room_name != null">
			        room_name=#{room_name},
			      </if>
			      <if test="room_type != '' and room_type != null">
			         room_type=#{room_type},
			      </if>
			      <if test="price != '' and price != null">
			         price=#{price},
			      </if>
			      <if test="max_capacity != '' and max_capacity != null">
			         max_capacity=#{max_capacity},
			      </if>
			      <if test="bed_type != '' and bed_type != null">
			         bed_type=#{bed_type},
			      </if>
			      <if test="room_size != '' and room_size != null">
			         room_size=#{room_size},
			      </if>
			      <if test="room_description != '' and room_description != null">
			         room_description=#{room_description},
			      </if>
			      <if test="amenities != '' and amenities != null">
			         amenities=#{amenities},
			      </if>
			      <if test="image != '' and image != null">
			      	 image = #{image},
			      </if>
			   </set>
		where room_id=#{room_id}
	</update>
	<delete id="removeroom" parameterType="int">
		<![CDATA[
			delete from room where room_id = #{room_id}
		]]>
	</delete>
	
<<<<<<< HEAD
	<select id="selectOverlappedGoodsName" resultType="int" parameterType="String">
        <![CDATA[
            SELECT count(*)
            FROM goods
            WHERE goods_name = #{goods_name}
        ]]>
    </select>
	
	<select id="selectNewGoodsList" resultMap="goodsResult" parameterType="java.util.Map">
		<![CDATA[
			SELECT *
			FROM goods
			WHERE DATE(goods_credate) BETWEEN #{beginDate} AND #{endDate}
			AND seller_id = #{seller_id}
			ORDER BY goods_credate DESC
			LIMIT #{offset}, #{limit}
		]]>
	</select>
	<update id="updateGoodsStatus" parameterType="java.util.Map">
		<![CDATA[
		    UPDATE goods
		    SET goods_status = #{goods_status}
		    WHERE goods_num = #{goods_num}
		      AND seller_id = #{seller_id}
		]]>
	</update>
</mapper>
=======
</mapper>
>>>>>>> feabb39b20e57cd8cdc0ade745f6a49c5e1755b4
