<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mypage">
	<!-- resultMap 정의 -->
	<resultMap id="memberResult" type="MemberVO">
	    <result property="member_num" column="member_num"/>
	    <result property="member_id" column="member_id"/>
	    <result property="member_pw" column="member_pw"/>
	    <result property="member_name" column="member_name"/>
	    <result property="member_gender" column="member_gender"/>
	    <result property="member_birth_y" column="member_birth_y"/>
	    <result property="member_birth_m" column="member_birth_m"/>
	    <result property="member_birth_d" column="member_birth_d"/>
	    <result property="member_birth_gn" column="member_birth_gn"/>
	    <result property="tel1" column="tel1"/>
	    <result property="tel2" column="tel2"/>
	    <result property="tel3" column="tel3"/>
	    <result property="smssts_yn" column="smssts_yn"/>
	    <result property="email1" column="email1"/>
	    <result property="email2" column="email2"/>
	    <result property="emailsts_yn" column="emailsts_yn"/>
	    <result property="zipcode" column="zipcode"/>
	    <result property="roadAddress" column="roadAddress"/>
	    <result property="jibunAddress" column="jibunAddress"/>
	    <result property="namujiAddress" column="namujiAddress"/>
	    <result property="member_join" column="member_join"/>
	    <result property="del_yn" column="del_yn"/>
	</resultMap>
	
	<resultMap id="goodsResult" type="goodsVO">
		<result property="goods_num" column="goods_num"/>
		<result property="goods_name" column="goods_name"/>
		<result property="goods_maker" column="goods_maker"/>
		<result property="goods_category" column="goods_category"/>
		<result property="goods_price" column="goods_price"/>
		<result property="goods_sales_price" column="goods_sales_price"/>
		<result property="goods_point" column="goods_point"/>
		<result property="goods_stock" column="goods_stock"/>
		<result property="goods_delivery_price" column="goods_delivery_price"/>
		<result property="goods_fileName" column="goods_fileName"/>
		<result property="goods_status" column="goods_status"/>
		<result property="goods_goods_writer_intro" column="goods_goods_writer_intro"/>
		<result property="goods_contents_order" column="goods_contents_order"/>
		<result property="goods_credate" column="goods_credate"/>
	</resultMap>

	<!-- resultMap 정의 -->
	<resultMap id="goodsReviewResult" type="GoodsReviewVO">
		<result property="review_id" column="review_id"/>
		<result property="member_id" column="member_id"/>
		<result property="order_num" column="order_num"/>
		<result property="rating" column="rating"/>
		<result property="subject" column="subject"/>
		<result property="content" column="content"/>
		<result property="file_name" column="file_name"/>
		<result property="created_at" column="created_at"/>
		<result property="updated_at" column="updated_at"/>
		<result property="goods_name" column="goods_name"/>
		<result property="del_yn" column="del_yn"/>
	</resultMap>

	<resultMap id="likeGoodsResult" type="LikeGoodsVO">
		<result property="like_goods_id" column="like_goods_id"/>
		<result property="member_id" column="member_id"/>
		<result property="goods_num" column="goods_num"/>
		<result property="goods_name" column="goods_name"/>
		<result property="goods_sales_price" column="goods_sales_price"/>
		<result property="goods_fileName" column="goods_fileName"/>
	</resultMap>

	<!-- 반려동물 resultMap 정의 -->
	<resultMap id="petResult" type="com.petmillie.mypage.vo.PetVO">
		<result property="pet_id" column="pet_id"/>
		<result property="member_id" column="member_id"/>
		<result property="pet_name" column="pet_name"/>
		<result property="pet_birth_date" column="pet_birth_date"/>
		<result property="pet_species" column="pet_species"/>
		<result property="pet_breed" column="pet_breed"/>
		<result property="pet_gender" column="pet_gender"/>
		<result property="pet_favorite_toy" column="pet_favorite_toy"/>
		<result property="pet_favorite_snack" column="pet_favorite_snack"/>
		<result property="reg_date" column="reg_date"/>
	</resultMap>

	<select id="selectLikeGoodsList" parameterType="string" resultMap="likeGoodsResult">
		SELECT
			l.like_goods_id,
			l.member_id,
			l.goods_num,
			g.goods_name,
			g.goods_sales_price,
			g.goods_fileName
		FROM likes_goods l
		JOIN goods g
		  ON l.goods_num = g.goods_num
		WHERE l.member_id = #{member_id}
	</select>

	<select id="selectLikedGoodsNums" parameterType="string" resultType="int">
		SELECT goods_num
		FROM likes_goods
		WHERE member_id = #{member_id}
	</select>

	<select id="existsLikeGoods" parameterType="map" resultType="int">
		SELECT COUNT(*)
		FROM likes_goods
		WHERE member_id = #{member_id} AND goods_num = #{goods_num}
	</select>

	<insert id="insertLikeGoods" parameterType="map">
		INSERT INTO likes_goods (member_id, goods_num)
		VALUES (#{member_id}, #{goods_num})
	</insert>

	<delete id="deleteLikeGoods" parameterType="map">
		DELETE FROM likes_goods
		WHERE member_id = #{member_id} AND goods_num = #{goods_num}
	</delete>

	<delete id="likeGoodsDelete" parameterType="int">
		DELETE FROM likes_goods
		WHERE like_goods_id = #{like_goods_id}
	</delete>

	<select id="selectMyOrderGoodsList" resultMap="goodsResult" parameterType="String">
		<![CDATA[
			select * from userorder
			where member_id=#{member_id}
			order by order_time desc
		]]>
	</select>

	<select id="selectMyOrderInfo" resultMap="goodsResult" parameterType="String">
		<![CDATA[
			select * from userorder
			where order_id=#{order_id}
		]]>
	</select>

	<select id="selectMyOrderHistoryList" resultMap="goodsResult" parameterType="java.util.Map">
		<![CDATA[
		  select * from userorder
		  where member_id=#{member_id}
		  and DATE_FORMAT(order_time,'%Y-%m-%d') between #{beginDate} and #{endDate}
		  order by order_time desc
		]]>
	</select>

	<update id="updateMember" parameterType="memberVO">
		<![CDATA[
			UPDATE member
	    	SET
	   	    member_pw = #{member_pw},
	        member_gender = #{member_gender},
	        member_birth_y = #{member_birth_y},
	        member_birth_m = #{member_birth_m},
	        member_birth_d = #{member_birth_d},
	        member_birth_gn = #{member_birth_gn},
	        tel1 = #{tel1},
	        tel2 = #{tel2},
	        tel3 = #{tel3},
	        smssts_yn = #{smssts_yn},
	        email1 = #{email1},
	        email2 = #{email2},
	        emailsts_yn = #{emailsts_yn},
	        zipcode = #{zipcode},
	        roadAddress = #{roadAddress},
	        jibunAddress = #{jibunAddress},
	        namujiAddress = #{namujiAddress}
	    	WHERE member_id = #{member_id}
    	]]>
	</update>

	<select id="selectMyDetailInfo" resultType="memberVO" parameterType="String">
		<![CDATA[
			select * from member
			where member_id=#{member_id}
		]]>
	</select>

	<update id="updateMyOrderCancel" parameterType="String">
	   update order
		  set delivery_state='cancel_order'
	   where order_id=#{order_id}
	</update>


	<insert id="insertGoodsReview" parameterType="GoodsReviewVO">
		INSERT INTO goods_review (member_id, order_num, rating,content,file_name)
		VALUES (#{member_id}, #{order_num}, #{rating}, #{content},#{file_name})
	</insert>

	<select id="selectGoodsReview" resultMap="goodsReviewResult" parameterType="string">
	<![CDATA[
		SELECT
			r.review_id,
			r.member_id,
			r.order_num,
			r.rating,
			r.content,
			r.file_name,
			r.created_at,
			r.updated_at,
			r.del_yn,
			o.goods_name
		FROM goods_review r
		JOIN userorder o
			ON r.order_num = o.order_num
		WHERE r.member_id = #{member_id}
	]]>
	</select>

	<select id="existsReview" resultType="int" parameterType="map">
		SELECT COUNT(*) > 0
		FROM goods_review
		WHERE order_num = #{order_num}
		  AND member_id = #{member_id}
	</select>

	<select id="getReviewDetailByReviewId" resultMap="goodsReviewResult" parameterType="int">
		<![CDATA[
		SELECT r.review_id, r.member_id, r.order_num, r.rating, r.content, r.file_name,
			   r.created_at, r.updated_at, r.del_yn,
			   o.goods_name
		FROM goods_review r
		JOIN userorder o ON r.order_num = o.order_num
		WHERE r.review_id = #{review_id}
		]]>
	</select>

	<update id="updateReview" parameterType="GoodsReviewVO">
		UPDATE goods_review
		SET rating= #{rating}, content= #{content}, file_name= #{file_name}
		WHERE review_id = #{review_id}
	</update>

	<delete id="deleteReview" parameterType="int">
		DELETE FROM goods_review WHERE review_id = #{review_id}
	</delete>

	<!-- 반려동물 관련 쿼리 -->
	<select id="selectMyPetList" parameterType="string" resultMap="petResult">
		<![CDATA[
			SELECT * FROM pet
			WHERE member_id = #{member_id}
			ORDER BY pet_id DESC
		]]>
	</select>

	<select id="selectPetCount" parameterType="string" resultType="int">
		<![CDATA[
			SELECT COUNT(*)
			FROM pet
			WHERE member_id = #{member_id}
		]]>
	</select>

	<insert id="insertPet" parameterType="com.petmillie.mypage.vo.PetVO">
		<![CDATA[
			INSERT INTO pet (member_id, pet_name, pet_birth_date, pet_species, pet_breed, pet_gender, pet_favorite_toy, pet_favorite_snack)
			VALUES (#{member_id}, #{pet_name}, #{pet_birth_date}, #{pet_species}, #{pet_breed}, #{pet_gender}, #{pet_favorite_toy}, #{pet_favorite_snack})
		]]>
	</insert>

	<select id="selectPet" parameterType="int" resultMap="petResult">
		<![CDATA[
			SELECT * FROM pet
			WHERE pet_id = #{pet_id}
		]]>
	</select>

	<update id="updatePet" parameterType="com.petmillie.mypage.vo.PetVO">
		<![CDATA[
			UPDATE pet
			SET pet_name = #{pet_name},
				pet_birth_date = #{pet_birth_date},
				pet_species = #{pet_species},
				pet_breed = #{pet_breed},
				pet_gender = #{pet_gender},
				pet_favorite_toy = #{pet_favorite_toy},
				pet_favorite_snack = #{pet_favorite_snack}
			WHERE pet_id = #{pet_id}
		]]>
	</update>

	<delete id="deletePet" parameterType="int">
		<![CDATA[
			DELETE FROM pet
			WHERE pet_id = #{pet_id}
		]]>
	</delete>
</mapper>
